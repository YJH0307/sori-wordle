<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ì†Œë¦¬ì›Œë“¤</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@700;900&display=swap" rel="stylesheet">
  <style>
    /* [ì›ë³¸ ìŠ¤íƒ€ì¼ ì½”ë“œ ì‹œì‘] [cite: 1-36] */
    body {
      margin: 0; padding: 20px;
      display: flex; flex-direction: column;
      align-items: center; justify-content: flex-start;
      min-height: 100vh;
      font-family: 'Noto Sans KR', sans-serif;
    }
    body.light { background: #fff; color: #000; }
    body.dark { background: #121213; color: #eee; }

    h1 { font-size: 40px; font-weight: 900; margin: 10px; }

    .controls { margin: 10px; text-align: center; }
    .controls button {
      font-size: 16px; margin: 0 5px; padding: 8px 14px;
      border: none; border-radius: 6px; cursor: pointer;
      font-family: 'Noto Sans KR', sans-serif; font-weight: 700;
    }
    body.light .controls button, body.light #shareBtn { background: #eee; color: #000; }
    body.dark  .controls button, body.dark #shareBtn { background: #ddd; color: #000; }

    .board {
      display: grid;
      grid-template-rows: repeat(6, 1fr);
      gap: 4px;                   /* â† ì¤„ ê°„ê²© í†µì¼ [cite: 9] */
      margin: 20px auto;
      width: 100%;
      justify-items: center;      /* ê° í–‰ì„ ê°€ë¡œ ì¤‘ì•™ ì •ë ¬ [cite: 10] */
    }

    .row {
      display: flex;
      gap: 4px;                   /* â† ì¹¸ ê°„ê²© í†µì¼ [cite: 11] */
      justify-content: center;    /* ì¹¸ë“¤ì„ í•­ìƒ ì¤‘ì•™ì— ë°°ì¹˜ [cite: 11] */
    }

    .cell {
      width: 45px;
      height: 45px;
      border: 2px solid #ccc;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 22px;
      font-weight: bold;
      font-family: 'Noto Sans KR', sans-serif;
      border-radius: 6px;
    }
    .cell.invalid {
      background: rgba(255, 0, 0, 0.2); /* ì—°í•œ ë¹¨ê°„ìƒ‰ ë°°ê²½ [cite: 14] */
      border-color: red;
    }
    
    /* === ëª¨ë°”ì¼ (480px ì´í•˜) === [cite: 15-17] */
    @media (max-width: 480px) {
      .board { gap: 4px; }
      .row { gap: 4px; }
      .cell { width: 34px; height: 34px; font-size: 18px; }
    }
    .correct { background: #6aaa64; color: white; }
    .present { background: #c9b458; color: white; }
    .absent  { background: #787c7e; color: white; }
    body.dark .cell { border-color: #3a3a3c; }
    body.dark .correct { background: #538d4e; }
    body.dark .present { background: #b59f3b; }
    body.dark .absent  { background: #3a3a3c; }

    #shareBtn { display: none; }

    /* === í‚¤ë³´ë“œ === [cite: 22-31] */
    #keyboard {
      display: flex;
      flex-direction: column;
      gap: 6px;
      margin: 20px auto;
      align-items: center;
      width: 100%;
      max-width: 500px;
    }
    .key-row {
      display: flex;
      justify-content: center;
      gap: 6px;
      width: 100%;
    }
    .key {
      flex: 1;
      aspect-ratio: 1/1;
      font-size: 18px;
      text-align: center;
      border: 1px solid #ccc;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
      user-select: none;
      background: #ddd;
      display: flex; justify-content: center; align-items: center;
      font-family: 'Noto Sans KR', sans-serif;
    }
    .key.correct { background: #6aaa64 !important; color: #fff !important; }
    .key.present { background: #c9b458 !important; color: #fff !important; }
    .key.absent  { background: #787c7e !important; color: #fff !important; }

    body.light .key { background: #ddd; color: #000; }
    body.dark  .key { background: #444; color: #fff; }

    .key.wide { flex: 1.5; }

    /* íŒì—… [cite: 32-36] */
    .popup {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.6); display: flex;
      justify-content: center; align-items: center;
    }
    .popup.hidden { display: none; }
    .popup-content {
      background: white; padding: 20px; border-radius: 8px;
      text-align: center; max-width: 320px; width: 80%;
      animation: fadeIn 0.6s ease;
      font-family: 'Noto Sans KR', sans-serif;
    }
    .popup-content h2 { margin-top: 0; font-weight: 900; }
    #popup-close { float: right; cursor: pointer; font-size: 20px; }
    @keyframes fadeIn { from{opacity:0} to{opacity:1} }
  </style>
</head>
<body class="light">
  <h1>ì†Œë¦¬ì›Œë“¤</h1>
  <div class="controls">
    <button id="statsBtn">í†µê³„ ë³´ê¸°</button>
    <button id="themeBtn" onclick="toggleTheme()">ğŸŒ™ ë‹¤í¬ ëª¨ë“œ</button>
  </div>

  <div class="board" id="board"></div>

  <div class="controls">
    <button id="shareBtn" onclick="shareResult()">ê³µìœ í•˜ê¸°</button>
  </div>

  <div id="keyboard"></div>

  <div id="popup" class="popup hidden">
    <div class="popup-content">
      <span id="popup-close">Ã—</span>
      <h2>ì˜¤ëŠ˜ì˜ ì†Œë¦¬ì›Œë“¤</h2>
      <p id="popup-message" style="white-space: pre-wrap;"></p>
    </div>
  </div>

<div id="helpPopup" class="popup hidden">
  <div class="popup-content">
    <span id="help-close" style="float:right;cursor:pointer;font-size:20px;">Ã—</span>
    <h2>ê²Œì„ ê·œì¹™</h2>
    <div style="text-align:center;line-height:1.8;font-size:15px;">
      <div style="font-size:20px;font-weight:900;margin-bottom:8px;">ì†Œë¦¬ì›Œë“¤</div>
      <div>ì†Œë¦¬MADì™€ ê´€ë ¨ëœ ëª¨ë“  ë‹¨ì–´ê°€ ì œì‹œì–´ì…ë‹ˆë‹¤. [cite: 37]</div>
      <div>í•˜ë£¨ì— ë¬¸ì œ 1ê°œ, ê¸°íšŒ 6ë²ˆ. [cite: 37]</div>
      <div style="margin-top:8px;">ìƒ‰ì˜ ì˜ë¯¸</div>
      <div>ğŸŸ© ìœ„ì¹˜Â·ë‚±ì ëª¨ë‘ ì¼ì¹˜</div>
      <div>ğŸŸ¨ ë‹¨ì–´ ì•ˆì— ìˆì§€ë§Œ ìœ„ì¹˜ ë‹¤ë¦„</div>
      <div>â¬œ ë‹¨ì–´ì— ì—†ìŒ</div>
      <div style="font-size:12px;color:#888;margin-top:10px;">â€œì†Œë¦¬ì›Œë“¤â€ì€ ìì •ì— ê°±ì‹ ë©ë‹ˆë‹¤. [cite: 37]</div>
    </div>
  </div>
</div>
  
<script>
  /* === ì›ë³¸ ë¡œì§ ìœ ì§€ ì‹œì‘ [cite: 38-143] === */
  function openHelpPopup(){
    document.getElementById("helpPopup").classList.remove("hidden");
  }
  function closeHelpPopup(){
    document.getElementById("helpPopup").classList.add("hidden");
  }
  document.getElementById("help-close").onclick = closeHelpPopup;

  const todayKey = "help-seen-" + new Date().toISOString().slice(0,10);
  if(!localStorage.getItem(todayKey)){
    setTimeout(openHelpPopup, 500);
    localStorage.setItem(todayKey,"true");
  }

  function loadTheme() {
    const t = localStorage.getItem('sori-wordle-theme') || 'light';
    document.body.className = t;
    document.getElementById('themeBtn').textContent =
      t === 'light' ? 'ğŸŒ™ ë‹¤í¬ ëª¨ë“œ' : 'â˜€ï¸ ë¼ì´íŠ¸ ëª¨ë“œ';
  }
  function toggleTheme() {
    const cur = document.body.className === 'light' ? 'dark' : 'light';
    document.body.className = cur;
    localStorage.setItem('sori-wordle-theme', cur);
    loadTheme();
  }
  loadTheme();

  // === í•œê¸€ ë¶„ë¦¬ [cite: 45-51] ===
  const ì´ˆì„±=["ã„±","ã„²","ã„´","ã„·","ã„¸","ã„¹","ã…","ã…‚","ã…ƒ","ã……","ã…†","ã…‡","ã…ˆ","ã…‰","ã…Š","ã…‹","ã…Œ","ã…","ã…"];
  const ì¤‘ì„±=["ã…","ã…","ã…‘","ã…’","ã…“","ã…”","ã…•","ã…–","ã…—","ã…˜","ã…™","ã…š","ã…›","ã…œ","ã…","ã…","ã…Ÿ","ã… ","ã…¡","ã…¢","ã…£"];
  const ì¢…ì„±=["","ã„±","ã„²","ã„³","ã„´","ã„µ","ã„¶","ã„·","ã„¹","ã„º","ã„»","ã„¼","ã„½","ã„¾","ã„¿","ã…€","ã…","ã…‚","ã…„","ã……","ã…†","ã…‡","ã…ˆ","ã…Š","ã…‹","ã…Œ","ã…","ã…"];
  const ê¼¬ë“¤ì´ì¤‘ëª¨ìŒ={ "ã…˜":["ã…—","ã…"],"ã…™":["ã…—","ã…"],"ã…š":["ã…—","ã…£"],"ã…":["ã…œ","ã…“"],"ã…":["ã…œ","ã…”"],"ã…Ÿ":["ã…œ","ã…£"],"ã…¢":["ã…¡","ã…£"],"ã…’":["ã…‘","ã…£"],"ã…–":["ã…•","ã…£"] };
  const ê¼¬ë“¤ì´ì¤‘ë°›ì¹¨={ "ã„³":["ã„±","ã……"],"ã„µ":["ã„´","ã…ˆ"],"ã„¶":["ã„´","ã…"],"ã„º":["ã„¹","ã„±"],"ã„»":["ã„¹","ã…"],"ã„¼":["ã„¹","ã…‚"],"ã„½":["ã„¹","ã……"],"ã„¾":["ã„¹","ã…Œ"],"ã„¿":["ã„¹","ã…"],"ã…€":["ã„¹","ã…"],"ã…„":["ã…‚","ã……"] };
  const ê¼¬ë“¤ëœì†Œë¦¬ = {"ã„²":["ã„±","ã„±"], "ã„¸":["ã„·","ã„·"], "ã…ƒ":["ã…‚","ã…‚"], "ã…‰":["ã…ˆ","ã…ˆ"], "ã…†":["ã……","ã……"]};

  function ë¶„ë¦¬(ch){
    const code=ch.charCodeAt(0)-0xAC00;
    if(code<0||code>11171) return [ch];
    const cho=Math.floor(code/588), jung=Math.floor((code-cho*588)/28), jong=code%28;
    let res=[];
    const choChar=ì´ˆì„±[cho];
    if(ê¼¬ë“¤ëœì†Œë¦¬[choChar]) res.push(...ê¼¬ë“¤ëœì†Œë¦¬[choChar]); else res.push(choChar);
    const jungChar=ì¤‘ì„±[jung];
    if(ê¼¬ë“¤ì´ì¤‘ëª¨ìŒ[jungChar]) res.push(...ê¼¬ë“¤ì´ì¤‘ëª¨ìŒ[jungChar]); else res.push(jungChar);
    if(jong!==0){
      const jongChar=ì¢…ì„±[jong];
      if(ê¼¬ë“¤ì´ì¤‘ë°›ì¹¨[jongChar]) res.push(...ê¼¬ë“¤ì´ì¤‘ë°›ì¹¨[jongChar]);
      else if(ê¼¬ë“¤ëœì†Œë¦¬[jongChar]) res.push(...ê¼¬ë“¤ëœì†Œë¦¬[jongChar]);
      else res.push(jongChar);
    }
    return res;
  }
    
  // === ìœ íš¨ì„± ê²€ì‚¬ ìœ í‹¸ [cite: 52-65] ===
  const ëœì†Œë¦¬ìŒ = {'ã„±ã„±':'ã„²','ã„·ã„·':'ã„¸','ã…‚ã…‚':'ã…ƒ','ã…ˆã…ˆ':'ã…‰','ã……ã……':'ã…†'};
  const ëª¨ìŒí•©ì¹˜ = {'ã…—ã…':'ã…˜','ã…—ã…':'ã…™','ã…—ã…£':'ã…š','ã…œã…“':'ã…','ã…œã…”':'ã…','ã…œã…£':'ã…Ÿ','ã…¡ã…£':'ã…¢','ã…‘ã…£':'ã…’','ã…•ã…£':'ã…–'};
  const ë°›ì¹¨í•©ì¹˜ = {'ã„±ã……':'ã„³','ã„´ã…ˆ':'ã„µ','ã„´ã…':'ã„¶','ã„¹ã„±':'ã„º','ã„¹ã…':'ã„»','ã„¹ã…‚':'ã„¼','ã„¹ã……':'ã„½','ã„¹ã…Œ':'ã„¾','ã„¹ã…':'ã„¿','ã„¹ã…':'ã…€','ã…‚ã……':'ã…„','ã„±ã„±':'ã„²','ã……ã……':'ã…†'};
  function isì´ˆì„±(x){ return ì´ˆì„±.includes(x); }
  function isì¤‘ì„±(x){ return ì¤‘ì„±.includes(x); }
  function isì¢…ì„±(x){ return ì¢…ì„±.includes(x) && x !== ""; }
  function canStartSyllable(a,b){ if (isì´ˆì„±(a)) return true; const pair = (a||'') + (b||''); return !!ëœì†Œë¦¬ìŒ[pair]; }

  function isValidJamoSequence(seq){
    let i = 0, n = seq.length;
    while (i < n){
      let cho = seq[i++];
      const tensify = ëœì†Œë¦¬ìŒ[cho + (seq[i]||'')];
      if (tensify){ cho = tensify; i++; }
      if (!isì´ˆì„±(cho)) return false;
      if (i >= n) return false;
      let jung1 = seq[i++], jung = jung1;
      const combV = ëª¨ìŒí•©ì¹˜[jung1 + (seq[i]||'')];
      if (combV){ jung = combV; i++; }
      if (!isì¤‘ì„±(jung)) return false;
      if (i < n){
        const combF = ë°›ì¹¨í•©ì¹˜[seq[i] + (seq[i+1]||'')];
        if (combF){ if (i+2 >= n || canStartSyllable(seq[i+2], seq[i+3])){ i += 2; continue; } }
        if (isì¢…ì„±(seq[i])){ if (i+1 >= n || canStartSyllable(seq[i+1], seq[i+2])){ i += 1; } }
      }
    }
    return i === n;
  }

  function markInvalidRow(){
    const rowEls = document.getElementById("board").children[currentRow].children;
    for (const c of rowEls) c.classList.add("invalid");
  }
  function clearInvalidRow(){
    const rowEls = document.getElementById("board").children[currentRow].children;
    for (const c of rowEls) c.classList.remove("invalid");
  }

  // === ë°ì´í„° ë° ì „ì—­ ìƒíƒœ [cite: 66-78] ===
  const sheetUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQ4cPYQbKRxFQsTv7byzVnKwN6WdlRECyFvSkn39mcnNIywqTZ9W71P8nzw0SI8oEP_4QzBFaJbNQyN/pub?output=csv";
  let ë‹¨ì–´ëª©ë¡ = [];
  const fallbackWords = ["ë‚ ì™ˆ","ì‚¬ì´í‚¤ë¼", "ëŒ€ì •ë ¹", "ë Œë”", "ìš°ì‚¬í…Œì´"];
  let ì •ë‹µ, ì •ë‹µë‚±ì;
  const maxRows = 6;
  let currentRow = 0, currentCol = 0, gameOver = false, currentGuess = [], lastTries = null;

  function seededRandom(seed) { const x = Math.sin(seed) * 10000; return x - Math.floor(x); }
  function pickDailyWord(pool) {
    const start = new Date("2025-01-01T00:00:00+09:00");
    const today = getKSTDate();
    const days = Math.floor((today - start) / (1000*60*60*24));
    const idx = Math.floor(seededRandom(days) * pool.length);
    return pool[idx];
  }

  function parseCSVFirstColumn(csvText){
    const clean = csvText.replace(/^\uFEFF/, "");
    const lines = clean.split(/\r?\n/);
    const onlyHangul = lines.map(line => (line.split(",")[0] || "").trim()).filter(w => /^[ê°€-í£]+$/.test(w));
    return onlyHangul;
  }

  function loadWords(){
    return fetch(sheetUrl + "&t=" + Date.now(), { cache: "no-store" })
      .then(r => { if(!r.ok) throw new Error("HTTP " + r.status); return r.text(); })
      .then(csv => {
        const parsed = parseCSVFirstColumn(csv);
        if (parsed.length === 0) throw new Error("ë¹ˆ ëª©ë¡");
        return parsed;
      });
  }

  loadWords()
    .then(list => { ë‹¨ì–´ëª©ë¡ = list; initGame(); })
    .catch(err => { ë‹¨ì–´ëª©ë¡ = fallbackWords; initGame(); });

  // === í†µê³„ ë° ë‚ ì§œ [cite: 79-83] ===
  function updateStats(win, tries){
    const stats=JSON.parse(localStorage.getItem("sori-stats")||'{"played":0,"wins":0,"dist":[0,0,0,0,0,0]}');
    stats.played++; if(win){ stats.wins++; stats.dist[tries-1]++; }
    localStorage.setItem("sori-stats", JSON.stringify(stats));
  }
  function getStats(){ return JSON.parse(localStorage.getItem("sori-stats")||'{"played":0,"wins":0,"dist":[0,0,0,0,0,0]}'); }
  function getKSTDate() { const now = new Date(); const utc = now.getTime() + (now.getTimezoneOffset() * 60000); return new Date(utc + (9 * 60 * 60000)); }

  // === ì´ˆê¸°í™” ë° ì…ë ¥ [cite: 84-125] ===
  function initGame(){
    const pool = (Array.isArray(ë‹¨ì–´ëª©ë¡) && ë‹¨ì–´ëª©ë¡.length>0) ? ë‹¨ì–´ëª©ë¡ : fallbackWords;
    ì •ë‹µ = pickDailyWord(pool) || fallbackWords[0];
    ì •ë‹µë‚±ì = [];
    for (let ch of ì •ë‹µ) ì •ë‹µë‚±ì.push(...ë¶„ë¦¬(ch));

    const board = document.getElementById("board");
    board.innerHTML = "";
    for (let r=0; r<maxRows; r++){
      const row = document.createElement("div");
      row.className = "row";
      for (let c=0; c<ì •ë‹µë‚±ì.length; c++){
        const cell = document.createElement("div");
        cell.className = "cell";
        row.appendChild(cell);
      }
      board.appendChild(row);
    }
    buildKeyboard();
  }

  function buildKeyboard(){
    const rows=[["ã…‚","ã…ˆ","ã„·","ã„±","ã……","ã…›","ã…•","ã…‘","ã…","ã…”"], ["ã…","ã„´","ã…‡","ã„¹","ã…","ã…—","ã…“","ã…","ã…£"], ["ì…ë ¥","ã…‹","ã…Œ","ã…Š","ã…","ã… ","ã…œ","ã…¡","ì‚­ì œ"]];
    const keyDiv=document.getElementById("keyboard"); keyDiv.innerHTML="";
    rows.forEach(row=>{
      const rowDiv=document.createElement("div"); rowDiv.className="key-row";
      row.forEach(k=>{
        const keyBtn=document.createElement("div");
        keyBtn.className="key" + (k==="ì…ë ¥"||k==="ì‚­ì œ" ? " wide" : "");
        keyBtn.textContent=k;
        keyBtn.onclick=()=>handleKey(k);
        rowDiv.appendChild(keyBtn);
      });
      keyDiv.appendChild(rowDiv);
    });
  }

  /* [ì¶”ê°€ ê¸°ëŠ¥ 1: PC ë¬¼ë¦¬ í‚¤ë³´ë“œ ì§€ì›] */
  const physicalKeyMap = {'q':'ã…‚','w':'ã…ˆ','e':'ã„·','r':'ã„±','t':'ã……','y':'ã…›','u':'ã…•','i':'ã…‘','o':'ã…','p':'ã…”','a':'ã…','s':'ã„´','d':'ã…‡','f':'ã„¹','g':'ã…','h':'ã…—','j':'ã…“','k':'ã…','l':'ã…£','z':'ã…‹','x':'ã…Œ','c':'ã…Š','v':'ã…','b':'ã… ','n':'ã…œ','m':'ã…¡'};
  window.addEventListener("keydown", (e) => {
    if (gameOver) return;
    if (e.key === "Enter") handleKey("ì…ë ¥");
    else if (e.key === "Backspace") handleKey("ì‚­ì œ");
    else if (physicalKeyMap[e.key.toLowerCase()]) handleKey(physicalKeyMap[e.key.toLowerCase()]);
    else if (/^[ã„±-ã…ã…-ã…£]$/.test(e.key)) handleKey(e.key);
  });

  function handleKey(k){
    if (gameOver) return;
    if (k === "ì…ë ¥") { submitGuess(); return; }
    if (k === "ì‚­ì œ") {
      if (currentCol > 0) {
        currentCol--; currentGuess.pop();
        document.getElementById("board").children[currentRow].children[currentCol].textContent = "";
        clearInvalidRow();
      }
      return;
    }
    if (currentCol < ì •ë‹µë‚±ì.length) {
      currentGuess.push(k);
      document.getElementById("board").children[currentRow].children[currentCol].textContent = k;
      currentCol++; clearInvalidRow();
    }
  }

  function submitGuess() {
    const guess = [...currentGuess];
    if (guess.length !== ì •ë‹µë‚±ì.length) return;
    if (!isValidJamoSequence(guess)) { markInvalidRow(); return; }

    const row = document.getElementById("board").children[currentRow].children;
    const freq = {};
    ì •ë‹µë‚±ì.forEach(l => freq[l] = (freq[l] || 0) + 1);

    const result = new Array(ì •ë‹µë‚±ì.length).fill("absent");
    for (let i=0; i<ì •ë‹µë‚±ì.length; i++) {
      if (guess[i] === ì •ë‹µë‚±ì[i]) { result[i] = "correct"; freq[guess[i]]--; }
    }
    for (let i=0; i<ì •ë‹µë‚±ì.length; i++) {
      if (result[i] === "correct") continue;
      if (freq[guess[i]] > 0) { result[i] = "present"; freq[guess[i]]--; }
    }

    for (let i=0; i<ì •ë‹µë‚±ì.length; i++) {
      row[i].classList.add(result[i]);
      updateKeyboard(guess[i], result[i]);
    }

    if (guess.join("") === ì •ë‹µë‚±ì.join("")) {
      gameOver = true; lastTries = currentRow+1;
      updateStats(true, lastTries);
      setTimeout(() => showPopup("ì •ë‹µ! ğŸ‰ ("+lastTries+"/6)"), 600);
      document.getElementById("shareBtn").style.display = "inline-block";
      return;
    }

    currentRow++; currentCol = 0; currentGuess = [];
    if (currentRow >= maxRows) {
      gameOver = true; lastTries = "X";
      updateStats(false,0);
      setTimeout(() => showPopup("ì‹¤íŒ¨! ì •ë‹µì€ "+ì •ë‹µ), 600);
      document.getElementById("shareBtn").style.display = "inline-block";
    }
  }

  function updateKeyboard(letter,state){
    document.querySelectorAll(".key").forEach(k=>{
      if(k.textContent===letter){
        if(state==="correct") k.className="key correct";
        else if(state==="present" && !k.classList.contains("correct")) k.className="key present";
        else if(state==="absent" && !k.classList.contains("correct") && !k.classList.contains("present")) k.className="key absent";
      }
    });
  }

  function showPopup(msg){ document.getElementById("popup-message").textContent=msg; document.getElementById("popup").classList.remove("hidden"); }
  document.getElementById("popup-close").onclick=()=>{ document.getElementById("popup").classList.add("hidden"); };

  // === ê³µìœ  ë° í†µê³„ [cite: 126-143] ===
  function shareResult() {
    const text = buildShareText();
    if (navigator.clipboard && navigator.clipboard.writeText) {
      navigator.clipboard.writeText(text).then(() => alert("ê²°ê³¼ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!")).catch(() => tryClipboardCopy(text));
    } else { tryClipboardCopy(text); }
  }

  function tryClipboardCopy(text){
    const ta = document.createElement("textarea"); ta.value = text; ta.style.position = "fixed"; ta.style.top = "-1000px";
    document.body.appendChild(ta); ta.select(); document.execCommand("copy"); document.body.removeChild(ta);
    alert("ê²°ê³¼ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!");
  }

  /* [ì¶”ê°€ ê¸°ëŠ¥ 2: ì›Œë“¤ í‘œì¤€ ê³µìœ  í…ìŠ¤íŠ¸ ê°œì„ ] */
  function buildShareText(){
    const tries = (lastTries===null) ? "X" : lastTries;
    const dateStr = getKSTDate().toISOString().slice(0,10);
    let output = `ì†Œë¦¬ì›Œë“¤ ${dateStr} ${tries}/6\n\n`;
    const rowsToPrint = (typeof lastTries === "number") ? lastTries : maxRows;
    for (let r=0; r<rowsToPrint; r++){
      const row = document.getElementById("board").children[r].children;
      for (let c=0; c<ì •ë‹µë‚±ì.length; c++){
        if (row[c].classList.contains("correct")) output += "ğŸŸ©";
        else if (row[c].classList.contains("present")) output += "ğŸŸ¨";
        else if (row[c].classList.contains("absent")) output += "â¬œ";
      }
      output += "\n";
    }
    output += "\nhttps://sori-wordle.com";
    return output;
  }

  document.getElementById("statsBtn").onclick=()=>{
    const s=getStats();
    let msg=`í”Œë ˆì´: ${s.played}\nìŠ¹ë¦¬: ${s.wins}\nìŠ¹ë¥ : ${s.played?Math.round(s.wins/s.played*100):0}%\n\nì‹œë„ ë¶„í¬:\n1íšŒ: ${s.dist[0]} 2íšŒ: ${s.dist[1]} 3íšŒ: ${s.dist[2]}\n4íšŒ: ${s.dist[3]} 5íšŒ: ${s.dist[4]} 6íšŒ: ${s.dist[5]}`;
    showPopup(msg);
  };
</script>
</body>
</html>
