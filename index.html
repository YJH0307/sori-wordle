<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ì†Œë¦¬ì›Œë“¤</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@700;900&display=swap" rel="stylesheet">
  <style>
    body {
      margin: 0; padding: 20px;
      display: flex; flex-direction: column;
      align-items: center; justify-content: flex-start;
      min-height: 100vh;
      font-family: 'Noto Sans KR', sans-serif;
    }
    body.light { background: #fff; color: #000; }
    body.dark { background: #121213; color: #eee; }

    h1 { font-size: 48px; font-weight: 900; margin: 10px; }

    .controls { margin: 10px; text-align: center; }
    .controls button {
      font-size: 18px; margin: 0 5px; padding: 8px 14px;
      border: none; border-radius: 6px; cursor: pointer;
    }
    body.light .controls button, body.light #shareBtn { background: #eee; color: #000; }
    body.dark  .controls button, body.dark #shareBtn { background: #ddd; color: #000; }

    .board { display: grid; grid-template-rows: repeat(6, 1fr); gap: 5px; margin: 20px auto; width: max-content; }
    .row { display: grid; gap: 5px; }
    .cell {
      width: 50px; height: 50px; border: 2px solid #ccc;
      display: flex; justify-content: center; align-items: center;
      font-size: 25px; font-weight: bold;
    }
    .correct { background: #6aaa64; color: white; }
    .present { background: #c9b458; color: white; }
    .absent  { background: #787c7e; color: white; }
    body.dark .cell { border-color: #3a3a3c; }
    body.dark .correct { background: #538d4e; }
    body.dark .present { background: #b59f3b; }
    body.dark .absent  { background: #3a3a3c; }

    #shareBtn { display: none; }

    #keyboard { display: grid; grid-template-rows: repeat(3, 1fr); gap: 5px; width: 100%; max-width: 600px; margin: 20px auto; }
    .key-row { display: flex; justify-content: center; gap: 5px; flex-wrap: wrap; }
    .key {
      flex: 1 1 9%;
      min-width: 36px;
      padding: 14px 0;
      font-size: 20px;
      text-align: center;
      border: 1px solid #ccc;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
      user-select: none;
    }
    body.light .key { background: #ddd; color: #000; }
    body.dark  .key { background: #444; color: #fff; }
    .key.correct { background: #6aaa64; color: #fff; }
    .key.present { background: #c9b458; color: #fff; }
    .key.absent  { background: #3a3a3c; color: #fff; }

    /* ëª¨ë°”ì¼ ë°˜ì‘í˜• */
    @media (max-width: 768px) {
      .cell { width: 42px; height: 42px; font-size: 20px; }
      .key { min-width: 34px; padding: 12px 0; font-size: 18px; }
    }
    @media (max-width: 480px) {
      .cell { width: 34px; height: 34px; font-size: 18px; }
      .key { min-width: 30px; padding: 10px 0; font-size: 16px; }
    }
  </style>
</head>
<body class="light">
  <h1>ì†Œë¦¬ì›Œë“¤</h1>
  <div class="controls">
    <button onclick="openStats()">í†µê³„ ë³´ê¸°</button>
    <button id="themeBtn" onclick="toggleTheme()">ğŸŒ™ ë‹¤í¬ ëª¨ë“œ</button>
  </div>

  <div class="board" id="board"></div>

  <div class="controls">
    <button id="shareBtn" onclick="shareResult()">ê³µìœ í•˜ê¸°</button>
  </div>

  <div id="keyboard"></div>

  <script>
    // === í…Œë§ˆ ===
    function loadTheme() {
      const t = localStorage.getItem('sori-wordle-theme') || 'light';
      document.body.className = t;
      document.getElementById('themeBtn').textContent =
        t === 'light' ? 'ğŸŒ™ ë‹¤í¬ ëª¨ë“œ' : 'â˜€ï¸ ë¼ì´íŠ¸ ëª¨ë“œ';
    }
    function toggleTheme() {
      const cur = document.body.className === 'light' ? 'dark' : 'light';
      document.body.className = cur;
      localStorage.setItem('sori-wordle-theme', cur);
      loadTheme();
    }
    loadTheme();

    // === í•œê¸€ ë¶„ë¦¬ ===
    const ì´ˆì„±=["ã„±","ã„²","ã„´","ã„·","ã„¸","ã„¹","ã…","ã…‚","ã…ƒ","ã……","ã…†","ã…‡","ã…ˆ","ã…‰","ã…Š","ã…‹","ã…Œ","ã…","ã…"];
    const ì¤‘ì„±=["ã…","ã…","ã…‘","ã…’","ã…“","ã…”","ã…•","ã…–","ã…—","ã…˜","ã…™","ã…š","ã…›","ã…œ","ã…","ã…","ã…Ÿ","ã… ","ã…¡","ã…¢","ã…£"];
    const ì¢…ì„±=["","ã„±","ã„²","ã„³","ã„´","ã„µ","ã„¶","ã„·","ã„¹","ã„º","ã„»","ã„¼","ã„½","ã„¾","ã„¿","ã…€","ã…","ã…‚","ã…„","ã……","ã…†","ã…‡","ã…ˆ","ã…Š","ã…‹","ã…Œ","ã…","ã…"];
    const ê¼¬ë“¤ì´ì¤‘ëª¨ìŒ={
      "ã…˜":["ã…—","ã…"],"ã…™":["ã…—","ã…"],"ã…š":["ã…—","ã…£"],
      "ã…":["ã…œ","ã…“"],"ã…":["ã…œ","ã…”"],"ã…Ÿ":["ã…œ","ã…£"],
      "ã…¢":["ã…¡","ã…£"], "ã…’":["ã…‘","ã…£"], "ã…–":["ã…•","ã…£"]
    };
    const ê¼¬ë“¤ì´ì¤‘ë°›ì¹¨={
      "ã„³":["ã„±","ã……"],"ã„µ":["ã„´","ã…ˆ"],"ã„¶":["ã„´","ã…"],
      "ã„º":["ã„¹","ã„±"],"ã„»":["ã„¹","ã…"],"ã„¼":["ã„¹","ã…‚"],
      "ã„½":["ã„¹","ã……"],"ã„¾":["ã„¹","ã…Œ"],"ã„¿":["ã„¹","ã…"],
      "ã…€":["ã„¹","ã…"],"ã…„":["ã…‚","ã……"]
    };

    function ë¶„ë¦¬(ch){
      const code=ch.charCodeAt(0)-0xAC00;
      if(code<0||code>11171) return [ch];
      const cho=Math.floor(code/588);
      const jung=Math.floor((code-cho*588)/28);
      const jong=code%28;
      let res=[ì´ˆì„±[cho]];
      const jungChar=ì¤‘ì„±[jung];
      if(ê¼¬ë“¤ì´ì¤‘ëª¨ìŒ[jungChar]) res.push(...ê¼¬ë“¤ì´ì¤‘ëª¨ìŒ[jungChar]);
      else res.push(jungChar);
      if(jong!==0){
        const jongChar=ì¢…ì„±[jong];
        if(ê¼¬ë“¤ì´ì¤‘ë°›ì¹¨[jongChar]) res.push(...ê¼¬ë“¤ì´ì¤‘ë°›ì¹¨[jongChar]);
        else res.push(jongChar);
      }
      return res;
    }

    // === ë‹¨ì–´ ëª©ë¡ (Google Sheets + fallback) ===
    const sheetUrl="https://docs.google.com/spreadsheets/d/e/2PACX-1vQ4cPYQbKRxFQsTv7byzVnKwN6WdlRECyFvSkn39mcnNIywqTZ9W71P8nzw0SI8oEP_4QzBFaJbNQyN/pub?output=csv";
    let ë‹¨ì–´ëª©ë¡=[];
    const fallbackWords=["ê°€ë‚˜ë‹¤","í•œê¸€"];

    fetch(sheetUrl+"&t="+Date.now())
      .then(r=>r.text())
      .then(csv=>{
        ë‹¨ì–´ëª©ë¡=csv.split("\n").map(s=>s.trim()).filter(Boolean);
        if(ë‹¨ì–´ëª©ë¡.length===0) ë‹¨ì–´ëª©ë¡=fallbackWords;
        initGame();
      })
      .catch(err=>{
        console.error("ë‹¨ì–´ ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:",err);
        ë‹¨ì–´ëª©ë¡=fallbackWords;
        initGame();
      });

    // === ê²Œì„ ===
    let ì •ë‹µ,ì •ë‹µë‚±ì,maxRows=6,board;
    let currentRow=0,currentCol=0,gameOver=false;
    let rowsData=[],currentGuess=[];
    let shiftOn=false;

    function initGame(){
      try {
        const start=new Date(2025,0,1),today=new Date();
        const days=Math.floor((today-start)/(1000*60*60*24));
        if (!ë‹¨ì–´ëª©ë¡ || ë‹¨ì–´ëª©ë¡.length === 0) {
          console.warn("ë‹¨ì–´ëª©ë¡ì´ ë¹„ì–´ ìˆì–´ fallback ì‚¬ìš©");
          ë‹¨ì–´ëª©ë¡=fallbackWords;
        }
        ì •ë‹µ=ë‹¨ì–´ëª©ë¡[days%ë‹¨ì–´ëª©ë¡.length];
        console.log("ì˜¤ëŠ˜ ì •ë‹µ:",ì •ë‹µ);
        ì •ë‹µë‚±ì=[]; for(let ch of ì •ë‹µ)ì •ë‹µë‚±ì.push(...ë¶„ë¦¬(ch));

        board=document.getElementById("board");
        board.innerHTML="";
        for(let r=0;r<maxRows;r++){
          const row=document.createElement("div"); row.className="row";
          row.style.gridTemplateColumns=`repeat(${ì •ë‹µë‚±ì.length},50px)`;
          for(let c=0;c<ì •ë‹µë‚±ì.length;c++){
            const cell=document.createElement("div"); cell.className="cell";
            row.appendChild(cell);
          }
          board.appendChild(row);
        }
        buildKeyboard();
      } catch(e) {
        console.error("initGame ì˜¤ë¥˜:", e);
      }
    }

    function buildKeyboard(){
      const keyboardRows = [
        ["ã…‚","ã…ˆ","ã„·","ã„±","ã……","ã…›","ã…•","ã…‘","ã…","ã…”"],
        ["ã…","ã„´","ã…‡","ã„¹","ã…","ã…—","ã…“","ã…","ã…£"],
        ["Shift","ã…‹","ã…Œ","ã…Š","ã…","ã… ","ã…œ","ã…¡","â†","Enter"]
      ];
      const keyDiv=document.getElementById("keyboard"); keyDiv.innerHTML="";
      keyboardRows.forEach(rowKeys=>{
        const rowDiv=document.createElement("div"); rowDiv.className="key-row";
        rowKeys.forEach(k=>{
          const keyBtn=document.createElement("div");
          keyBtn.className="key"; keyBtn.textContent=k;
          keyBtn.onclick=()=>handleVirtualKey(k);
          rowDiv.appendChild(keyBtn);
        });
        keyDiv.appendChild(rowDiv);
      });
    }

    function handleVirtualKey(k){
      if (k === "Shift") { shiftOn=!shiftOn; return; }
      handleKey(k);
    }

    function handleKey(k){
      if(gameOver)return;
      if(shiftOn){
        const map={"ã…‚":"ã…ƒ","ã…ˆ":"ã…‰","ã„·":"ã„¸","ã„±":"ã„²","ã……":"ã…†"};
        if(map[k]) { k=map[k]; shiftOn=false; }
      }
      if(k==="Enter"){
        if(currentCol===ì •ë‹µë‚±ì.length)submitGuess();
      } else if(k==="â†"){
        if(currentCol>0){
          currentCol--; currentGuess.pop();
          board.children[currentRow].children[currentCol].textContent="";
        }
      } else {
        if(currentCol<ì •ë‹µë‚±ì.length){
          currentGuess.push(k);
          board.children[currentRow].children[currentCol].textContent=k;
          currentCol++;
        }
      }
    }

    // ---- íŒì • ----
    function submitGuess(){
      const guessë‚±ì=[...currentGuess];
      const L=ì •ë‹µë‚±ì.length;
      if(guessë‚±ì.length!==L)return;

      const row=board.children[currentRow].children;
      const freq={};
      for(let i=0;i<L;i++){freq[ì •ë‹µë‚±ì[i]]=(freq[ì •ë‹µë‚±ì[i]]||0)+1;}

      const result=new Array(L).fill("absent");
      for(let i=0;i<L;i++){
        if(guessë‚±ì[i]===ì •ë‹µë‚±ì[i]){ result[i]="correct"; freq[guessë‚±ì[i]]--; }
      }
      for(let i=0;i<L;i++){
        if(result[i]==="correct")continue;
        if(freq[guessë‚±ì[i]]>0){ result[i]="present"; freq[guessë‚±ì[i]]--; }
      }

      for(let i=0;i<L;i++){
        row[i].textContent=guessë‚±ì[i];
        row[i].classList.add(result[i]);
        updateKeyboard(guessë‚±ì[i],result[i]);
      }

      if(guessë‚±ì.join("")===ì •ë‹µë‚±ì.join("")){
        setTimeout(()=>alert("ì •ë‹µ! ğŸ‰"),100);
        gameOver=true;
        document.getElementById("shareBtn").style.display="inline-block";
      }
      currentRow++; currentCol=0; currentGuess=[];
      if(currentRow>=maxRows&&!gameOver){
        setTimeout(()=>alert(`ì‹¤íŒ¨! ì •ë‹µì€ ${ì •ë‹µ}`),100);
        gameOver=true;
        document.getElementById("shareBtn").style.display="inline-block";
      }
    }

    function updateKeyboard(letter,state){
      document.querySelectorAll(".key").forEach(k=>{
        if(k.textContent===letter){
          if(state==="correct")k.className="key correct";
          else if(state==="present"&&!k.classList.contains("correct"))k.className="key present";
          else if(state==="absent"&&!k.classList.contains("correct")&&!k.classList.contains("present"))k.className="key absent";
        }
      });
    }

    function shareResult(){
      const todayKey=new Date().toISOString().split("T")[0];
      let txt=`ì†Œë¦¬ì›Œë“¤ ${todayKey}\n`;
      txt+=gameOver?`${currentRow}/${maxRows}\n\n`:`ì‹¤íŒ¨\n\n`;
      console.log(txt);
      navigator.clipboard.writeText(txt).then(()=>alert("ê²°ê³¼ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!"));
    }
  </script>
</body>
</html>
